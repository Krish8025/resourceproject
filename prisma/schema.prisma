generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement()) @map("user_id")
  name      String   @db.VarChar(100)
  email     String   @unique @db.VarChar(100)
  role      String   @db.VarChar(20)
  password  String   @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp()

  bookings         Booking[] @relation("UserBookings")
  approvedBookings Booking[] @relation("ApproverBookings")

  @@map("users")
}

model ResourceType {
  id   Int    @id @default(autoincrement()) @map("resource_type_id")
  name String @map("type_name") @db.VarChar(100)
  
  resources Resource[]

  @@map("resource_types")
}

model Building {
  id             Int     @id @default(autoincrement()) @map("building_id")
  name           String  @map("building_name") @db.VarChar(100)
  buildingNumber String? @map("building_number") @db.VarChar(50)
  totalFloors    Int?    @map("total_floors")

  resources Resource[]

  @@map("buildings")
}

model Resource {
  id             Int     @id @default(autoincrement()) @map("resource_id")
  name           String  @map("resource_name") @db.VarChar(100)
  resourceTypeId Int     @map("resource_type_id")
  buildingId     Int?    @map("building_id")
  floorNumber    Int?    @map("floor_number")
  description    String? @db.Text

  type     ResourceType @relation(fields: [resourceTypeId], references: [id], onDelete: Cascade)
  building Building?    @relation(fields: [buildingId], references: [id], onDelete: Cascade)

  facilities  Facility[]
  maintenance Maintenance[]
  bookings    Booking[]
  cupboards   Cupboard[]

  @@map("resources")
}

model Facility {
  id         Int     @id @default(autoincrement()) @map("facility_id")
  resourceId Int     @map("resource_id")
  name       String  @map("facility_name") @db.VarChar(100)
  details    String? @db.Text

  resource Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@map("facilities")
}

model Maintenance {
  id            Int       @id @default(autoincrement()) @map("maintenance_id")
  resourceId    Int       @map("resource_id")
  type          String?   @map("maintenance_type") @db.VarChar(100)
  scheduledDate DateTime? @map("scheduled_date") @db.Date
  status        String?   @db.VarChar(20)
  notes         String?   @db.Text

  resource Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@map("maintenance")
}

model Booking {
  id            Int      @id @default(autoincrement()) @map("booking_id")
  resourceId    Int      @map("resource_id")
  userId        Int      @map("user_id")
  startDateTime DateTime @map("start_datetime") @db.Timestamp()
  endDateTime   DateTime @map("end_datetime") @db.Timestamp()
  status        String?  @db.VarChar(20)
  approverId    Int?     @map("approver_id")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp()

  resource Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  user     User     @relation("UserBookings", fields: [userId], references: [id], onDelete: Cascade)
  approver User?    @relation("ApproverBookings", fields: [approverId], references: [id])

  @@map("bookings")
}

model Cupboard {
  id           Int     @id @default(autoincrement()) @map("cupboard_id")
  resourceId   Int     @map("resource_id")
  name         String? @map("cupboard_name") @db.VarChar(100)
  totalShelves Int?    @map("total_shelves")

  resource Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  shelves  Shelf[]

  @@map("cupboards")
}

model Shelf {
  id          Int     @id @default(autoincrement()) @map("shelf_id")
  cupboardId  Int     @map("cupboard_id")
  shelfNumber Int?    @map("shelf_number")
  capacity    Int?
  description String? @db.Text

  cupboard Cupboard @relation(fields: [cupboardId], references: [id], onDelete: Cascade)

  @@map("shelves")
}
